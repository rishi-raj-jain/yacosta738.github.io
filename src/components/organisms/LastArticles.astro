---
import i18next, { t } from 'i18next'
import { Article, jsonToArticle } from '@models:Article'
import { MarkdownInstance } from 'astro'

const articlesFiles: { [key: string]: Promise<MarkdownInstance<Record<string, any>>[]> } = {
	en: Astro.glob('../../pages/blog/**/*.md'),
	es: Astro.glob('../../pages/es/blog/**/*.md')
}
const postsData = i18next.language in articlesFiles ? await articlesFiles[i18next.language] : []
const maxNumberOfPosts = 3
const posts: Article[] = postsData
	.filter((post) => !post.frontmatter.draft && post.frontmatter.lang === i18next.language)
	.map((post) => jsonToArticle(post))
	.sort((a, b) => {
		let aDate = new Date(a.date)
		let bDate = new Date(b.date)
		return bDate.getTime() - aDate.getTime()
	})
	.slice(0, maxNumberOfPosts)
---

<section id='last3articles'>
	<h2 class='numbered-heading'>{t('menus.last-articles')}</h2>
	<div class='grid grid-cols-1 md:grid-cols-3 gap-4 my-2'>
		{
			posts.map((post) => (
				<article class='max-w-sm bg-white rounded-lg border border-gray-200 shadow-md dark:bg-gray-800 dark:border-gray-700'>
					<a href={post.url}>
						<img class='rounded-t-lg' src={post.cover} alt={post.title} />
					</a>
					<div class='p-5'>
						<a href={post.url}>
							<h5 class='mb-2 text-2xl font-bold tracking-tight text-gray-900 dark:text-white'>
								{post.title}
							</h5>
						</a>
						<p class='mb-3 font-normal text-gray-700 dark:text-gray-400 line-clamp-4 md:line-clamp-3'>
							{post.description}
						</p>
						<a
							href={post.url}
							class='inline-flex items-center py-2 px-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800'
						>
							Read more
							<svg
								aria-hidden='true'
								class='ml-2 -mr-1 w-4 h-4'
								fill='currentColor'
								viewBox='0 0 20 20'
								xmlns='http://www.w3.org/2000/svg'
							>
								<path
									fill-rule='evenodd'
									d='M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z'
									clip-rule='evenodd'
								/>
							</svg>
						</a>
					</div>
				</article>
			))
		}
	</div>
</section>
